<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Testcase: map-reduce - Rust By Example</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A description">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="index.html">Introduction</a></li><li><a href="hello.html"><strong>1.</strong> Hello World</a></li><li><ul class="section"><li><a href="hello/comment.html"><strong>1.1.</strong> Comments</a></li><li><a href="hello/print.html"><strong>1.2.</strong> Formatted print</a></li><li><ul class="section"><li><a href="hello/print/print_debug.html"><strong>1.2.1.</strong> Debug</a></li><li><a href="hello/print/print_display.html"><strong>1.2.2.</strong> Display</a></li><li><ul class="section"><li><a href="hello/print/print_display/testcase_list.html"><strong>1.2.2.1.</strong> Testcase: List</a></li></ul></li><li><a href="hello/print/fmt.html"><strong>1.2.3.</strong> Formatting</a></li></ul></li></ul></li><li><a href="primitives.html"><strong>2.</strong> Primitives</a></li><li><ul class="section"><li><a href="primitives/literals.html"><strong>2.1.</strong> Literals and operators</a></li><li><a href="primitives/tuples.html"><strong>2.2.</strong> Tuples</a></li><li><a href="primitives/array.html"><strong>2.3.</strong> Arrays and Slices</a></li></ul></li><li><a href="custom_types.html"><strong>3.</strong> Custom Types</a></li><li><ul class="section"><li><a href="custom_types/structs.html"><strong>3.1.</strong> Structures</a></li><li><a href="custom_types/enum.html"><strong>3.2.</strong> Enums</a></li><li><ul class="section"><li><a href="custom_types/enum/enum_use.html"><strong>3.2.1.</strong> use</a></li><li><a href="custom_types/enum/c_like.html"><strong>3.2.2.</strong> C-like</a></li><li><a href="custom_types/enum/testcase_linked_list.html"><strong>3.2.3.</strong> Testcase: linked-list</a></li></ul></li><li><a href="custom_types/constants.html"><strong>3.3.</strong> constants</a></li></ul></li><li><a href="variable_bindings.html"><strong>4.</strong> Variable Bindings</a></li><li><ul class="section"><li><a href="variable_bindings/mut.html"><strong>4.1.</strong> Mutability</a></li><li><a href="variable_bindings/scope.html"><strong>4.2.</strong> Scope and Shadowing</a></li><li><a href="variable_bindings/declare.html"><strong>4.3.</strong> Declare first</a></li></ul></li><li><a href="types.html"><strong>5.</strong> Types</a></li><li><ul class="section"><li><a href="types/cast.html"><strong>5.1.</strong> Casting</a></li><li><a href="types/literals.html"><strong>5.2.</strong> Literals</a></li><li><a href="types/inference.html"><strong>5.3.</strong> Inference</a></li><li><a href="types/alias.html"><strong>5.4.</strong> Aliasing</a></li></ul></li><li><a href="conversion.html"><strong>6.</strong> Conversion</a></li><li><ul class="section"><li><a href="conversion/from_into.html"><strong>6.1.</strong> From and Into</a></li><li><a href="conversion/string.html"><strong>6.2.</strong> To and From String</a></li></ul></li><li><a href="expression.html"><strong>7.</strong> Expressions</a></li><li><a href="flow_control.html"><strong>8.</strong> Flow Control</a></li><li><ul class="section"><li><a href="flow_control/if_else.html"><strong>8.1.</strong> if/else</a></li><li><a href="flow_control/loop.html"><strong>8.2.</strong> loop</a></li><li><ul class="section"><li><a href="flow_control/loop/nested.html"><strong>8.2.1.</strong> Nesting and labels</a></li><li><a href="flow_control/loop/return.html"><strong>8.2.2.</strong> Returning from loops</a></li></ul></li><li><a href="flow_control/while.html"><strong>8.3.</strong> while</a></li><li><a href="flow_control/for.html"><strong>8.4.</strong> for and range</a></li><li><a href="flow_control/match.html"><strong>8.5.</strong> match</a></li><li><ul class="section"><li><a href="flow_control/match/destructuring.html"><strong>8.5.1.</strong> Destructuring</a></li><li><ul class="section"><li><a href="flow_control/match/destructuring/destructure_tuple.html"><strong>8.5.1.1.</strong> tuples</a></li><li><a href="flow_control/match/destructuring/destructure_enum.html"><strong>8.5.1.2.</strong> enums</a></li><li><a href="flow_control/match/destructuring/destructure_pointers.html"><strong>8.5.1.3.</strong> pointers/ref</a></li><li><a href="flow_control/match/destructuring/destructure_structures.html"><strong>8.5.1.4.</strong> structs</a></li></ul></li><li><a href="flow_control/match/guard.html"><strong>8.5.2.</strong> Guards</a></li><li><a href="flow_control/match/binding.html"><strong>8.5.3.</strong> Binding</a></li></ul></li><li><a href="flow_control/if_let.html"><strong>8.6.</strong> if let</a></li><li><a href="flow_control/while_let.html"><strong>8.7.</strong> while let</a></li></ul></li><li><a href="fn.html"><strong>9.</strong> Functions</a></li><li><ul class="section"><li><a href="fn/methods.html"><strong>9.1.</strong> Methods</a></li><li><a href="fn/closures.html"><strong>9.2.</strong> Closures</a></li><li><ul class="section"><li><a href="fn/closures/capture.html"><strong>9.2.1.</strong> Capturing</a></li><li><a href="fn/closures/input_parameters.html"><strong>9.2.2.</strong> As input parameters</a></li><li><a href="fn/closures/anonymity.html"><strong>9.2.3.</strong> Type anonymity</a></li><li><a href="fn/closures/input_functions.html"><strong>9.2.4.</strong> Input functions</a></li><li><a href="fn/closures/output_parameters.html"><strong>9.2.5.</strong> As output parameters</a></li><li><a href="fn/closures/closure_examples.html"><strong>9.2.6.</strong> Examples in <code>std</code></a></li><li><ul class="section"><li><a href="fn/closures/closure_examples/iter_any.html"><strong>9.2.6.1.</strong> Iterator::any</a></li><li><a href="fn/closures/closure_examples/iter_find.html"><strong>9.2.6.2.</strong> Iterator::find</a></li></ul></li></ul></li><li><a href="fn/hof.html"><strong>9.3.</strong> Higher Order Functions</a></li></ul></li><li><a href="mod.html"><strong>10.</strong> Modules</a></li><li><ul class="section"><li><a href="mod/visibility.html"><strong>10.1.</strong> Visibility</a></li><li><a href="mod/struct_visibility.html"><strong>10.2.</strong> Struct visibility</a></li><li><a href="mod/use.html"><strong>10.3.</strong> The <code>use</code> declaration</a></li><li><a href="mod/super.html"><strong>10.4.</strong> <code>super</code> and <code>self</code></a></li><li><a href="mod/split.html"><strong>10.5.</strong> File hierarchy</a></li></ul></li><li><a href="crates.html"><strong>11.</strong> Crates</a></li><li><ul class="section"><li><a href="crates/lib.html"><strong>11.1.</strong> Library</a></li><li><a href="crates/link.html"><strong>11.2.</strong> <code>extern crate</code></a></li></ul></li><li><a href="cargo.html"><strong>12.</strong> Cargo</a></li><li><ul class="section"><li><a href="cargo/deps.html"><strong>12.1.</strong> Dependencies</a></li><li><a href="cargo/conventions.html"><strong>12.2.</strong> Conventions</a></li><li><a href="cargo/test.html"><strong>12.3.</strong> Tests</a></li></ul></li><li><a href="attribute.html"><strong>13.</strong> Attributes</a></li><li><ul class="section"><li><a href="attribute/unused.html"><strong>13.1.</strong> <code>dead_code</code></a></li><li><a href="attribute/crate.html"><strong>13.2.</strong> Crates</a></li><li><a href="attribute/cfg.html"><strong>13.3.</strong> <code>cfg</code></a></li><li><ul class="section"><li><a href="attribute/cfg/custom.html"><strong>13.3.1.</strong> Custom</a></li></ul></li></ul></li><li><a href="generics.html"><strong>14.</strong> Generics</a></li><li><ul class="section"><li><a href="generics/gen_fn.html"><strong>14.1.</strong> Functions</a></li><li><a href="generics/impl.html"><strong>14.2.</strong> Implementation</a></li><li><a href="generics/gen_trait.html"><strong>14.3.</strong> Traits</a></li><li><a href="generics/bounds.html"><strong>14.4.</strong> Bounds</a></li><li><ul class="section"><li><a href="generics/bounds/testcase_empty.html"><strong>14.4.1.</strong> Testcase: empty bounds</a></li></ul></li><li><a href="generics/multi_bounds.html"><strong>14.5.</strong> Multiple bounds</a></li><li><a href="generics/where.html"><strong>14.6.</strong> Where clauses</a></li><li><a href="generics/new_types.html"><strong>14.7.</strong> New Type Idiom</a></li><li><a href="generics/assoc_items.html"><strong>14.8.</strong> Associated items</a></li><li><ul class="section"><li><a href="generics/assoc_items/the_problem.html"><strong>14.8.1.</strong> The Problem</a></li><li><a href="generics/assoc_items/types.html"><strong>14.8.2.</strong> Associated types</a></li></ul></li><li><a href="generics/phantom.html"><strong>14.9.</strong> Phantom type parameters</a></li><li><ul class="section"><li><a href="generics/phantom/testcase_units.html"><strong>14.9.1.</strong> Testcase: unit clarification</a></li></ul></li></ul></li><li><a href="scope.html"><strong>15.</strong> Scoping rules</a></li><li><ul class="section"><li><a href="scope/raii.html"><strong>15.1.</strong> RAII</a></li><li><a href="scope/move.html"><strong>15.2.</strong> Ownership and moves</a></li><li><ul class="section"><li><a href="scope/move/mut.html"><strong>15.2.1.</strong> Mutability</a></li></ul></li><li><a href="scope/borrow.html"><strong>15.3.</strong> Borrowing</a></li><li><ul class="section"><li><a href="scope/borrow/mut.html"><strong>15.3.1.</strong> Mutability</a></li><li><a href="scope/borrow/freeze.html"><strong>15.3.2.</strong> Freezing</a></li><li><a href="scope/borrow/alias.html"><strong>15.3.3.</strong> Aliasing</a></li><li><a href="scope/borrow/ref.html"><strong>15.3.4.</strong> The ref pattern</a></li></ul></li><li><a href="scope/lifetime.html"><strong>15.4.</strong> Lifetimes</a></li><li><ul class="section"><li><a href="scope/lifetime/explicit.html"><strong>15.4.1.</strong> Explicit annotation</a></li><li><a href="scope/lifetime/fn.html"><strong>15.4.2.</strong> Functions</a></li><li><a href="scope/lifetime/methods.html"><strong>15.4.3.</strong> Methods</a></li><li><a href="scope/lifetime/struct.html"><strong>15.4.4.</strong> Structs</a></li><li><a href="scope/lifetime/lifetime_bounds.html"><strong>15.4.5.</strong> Bounds</a></li><li><a href="scope/lifetime/lifetime_coercion.html"><strong>15.4.6.</strong> Coercion</a></li><li><a href="scope/lifetime/static_lifetime.html"><strong>15.4.7.</strong> static</a></li><li><a href="scope/lifetime/elision.html"><strong>15.4.8.</strong> elision</a></li></ul></li></ul></li><li><a href="trait.html"><strong>16.</strong> Traits</a></li><li><ul class="section"><li><a href="trait/derive.html"><strong>16.1.</strong> Derive</a></li><li><a href="trait/ops.html"><strong>16.2.</strong> Operator Overloading</a></li><li><a href="trait/drop.html"><strong>16.3.</strong> Drop</a></li><li><a href="trait/iter.html"><strong>16.4.</strong> Iterators</a></li><li><a href="trait/clone.html"><strong>16.5.</strong> Clone</a></li></ul></li><li><a href="macros.html"><strong>17.</strong> macro_rules!</a></li><li><ul class="section"><li><a href="macros/syntax.html"><strong>17.1.</strong> Syntax</a></li><li><ul class="section"><li><a href="macros/designators.html"><strong>17.1.1.</strong> Designators</a></li><li><a href="macros/overload.html"><strong>17.1.2.</strong> Overload</a></li><li><a href="macros/repeat.html"><strong>17.1.3.</strong> Repeat</a></li></ul></li><li><a href="macros/dry.html"><strong>17.2.</strong> DRY (Don't Repeat Yourself)</a></li><li><a href="macros/dsl.html"><strong>17.3.</strong> DSL (Domain Specific Languages)</a></li><li><a href="macros/variadics.html"><strong>17.4.</strong> Variadics</a></li></ul></li><li><a href="error.html"><strong>18.</strong> Error handling</a></li><li><ul class="section"><li><a href="error/panic.html"><strong>18.1.</strong> <code>panic</code></a></li><li><a href="error/option_unwrap.html"><strong>18.2.</strong> <code>Option</code> &amp; <code>unwrap</code></a></li><li><ul class="section"><li><a href="error/option_unwrap/map.html"><strong>18.2.1.</strong> Combinators: <code>map</code></a></li><li><a href="error/option_unwrap/and_then.html"><strong>18.2.2.</strong> Combinators: <code>and_then</code></a></li></ul></li><li><a href="error/result.html"><strong>18.3.</strong> <code>Result</code></a></li><li><ul class="section"><li><a href="error/result/result_map.html"><strong>18.3.1.</strong> <code>map</code> for <code>Result</code></a></li><li><a href="error/result/result_alias.html"><strong>18.3.2.</strong> aliases for <code>Result</code></a></li><li><a href="error/result/early_returns.html"><strong>18.3.3.</strong> Early returns</a></li><li><a href="error/result/enter_question_mark.html"><strong>18.3.4.</strong> Introducing <code>?</code></a></li></ul></li><li><a href="error/multiple_error_types.html"><strong>18.4.</strong> Multiple error types</a></li><li><ul class="section"><li><a href="error/multiple_error_types/option_result.html"><strong>18.4.1.</strong> Pulling <code>Result</code>s out of <code>Option</code>s</a></li><li><a href="error/multiple_error_types/define_error_type.html"><strong>18.4.2.</strong> Defining an error type</a></li><li><a href="error/multiple_error_types/boxing_errors.html"><strong>18.4.3.</strong> <code>Box</code>ing errors</a></li><li><a href="error/multiple_error_types/reenter_question_mark.html"><strong>18.4.4.</strong> Other uses of <code>?</code></a></li><li><a href="error/multiple_error_types/wrap_error.html"><strong>18.4.5.</strong> Wrapping errors</a></li></ul></li><li><a href="error/iter_result.html"><strong>18.5.</strong> Iterating over <code>Result</code>s</a></li></ul></li><li><a href="std.html"><strong>19.</strong> Std library types</a></li><li><ul class="section"><li><a href="std/box.html"><strong>19.1.</strong> Box, stack and heap</a></li><li><a href="std/vec.html"><strong>19.2.</strong> Vectors</a></li><li><a href="std/str.html"><strong>19.3.</strong> Strings</a></li><li><a href="std/option.html"><strong>19.4.</strong> <code>Option</code></a></li><li><a href="std/result.html"><strong>19.5.</strong> <code>Result</code></a></li><li><ul class="section"><li><a href="std/result/question_mark.html"><strong>19.5.1.</strong> <code>?</code></a></li></ul></li><li><a href="std/panic.html"><strong>19.6.</strong> <code>panic!</code></a></li><li><a href="std/hash.html"><strong>19.7.</strong> HashMap</a></li><li><ul class="section"><li><a href="std/hash/alt_key_types.html"><strong>19.7.1.</strong> Alternate/custom key types</a></li><li><a href="std/hash/hashset.html"><strong>19.7.2.</strong> HashSet</a></li></ul></li></ul></li><li><a href="std_misc.html"><strong>20.</strong> Std misc</a></li><li><ul class="section"><li><a href="std_misc/threads.html"><strong>20.1.</strong> Threads</a></li><li><ul class="section"><li><a href="std_misc/threads/testcase_mapreduce.html" class="active"><strong>20.1.1.</strong> Testcase: map-reduce</a></li></ul></li><li><a href="std_misc/channels.html"><strong>20.2.</strong> Channels</a></li><li><a href="std_misc/path.html"><strong>20.3.</strong> Path</a></li><li><a href="std_misc/file.html"><strong>20.4.</strong> File I/O</a></li><li><ul class="section"><li><a href="std_misc/file/open.html"><strong>20.4.1.</strong> <code>open</code></a></li><li><a href="std_misc/file/create.html"><strong>20.4.2.</strong> <code>create</code></a></li></ul></li><li><a href="std_misc/process.html"><strong>20.5.</strong> Child processes</a></li><li><ul class="section"><li><a href="std_misc/process/pipe.html"><strong>20.5.1.</strong> Pipes</a></li><li><a href="std_misc/process/wait.html"><strong>20.5.2.</strong> Wait</a></li></ul></li><li><a href="std_misc/fs.html"><strong>20.6.</strong> Filesystem Operations</a></li><li><a href="std_misc/arg.html"><strong>20.7.</strong> Program arguments</a></li><li><ul class="section"><li><a href="std_misc/arg/matching.html"><strong>20.7.1.</strong> Argument parsing</a></li></ul></li><li><a href="std_misc/ffi.html"><strong>20.8.</strong> Foreign Function Interface</a></li></ul></li><li><a href="testing.html"><strong>21.</strong> Testing</a></li><li><ul class="section"><li><a href="testing/unit_testing.html"><strong>21.1.</strong> Unit testing</a></li><li><a href="testing/doc_testing.html"><strong>21.2.</strong> Documentation testing</a></li><li><a href="testing/integration_testing.html"><strong>21.3.</strong> Integration testing</a></li><li><a href="testing/dev_dependencies.html"><strong>21.4.</strong> Dev-dependencies</a></li></ul></li><li><a href="meta.html"><strong>22.</strong> Meta</a></li><li><ul class="section"><li><a href="meta/doc.html"><strong>22.1.</strong> Documentation</a></li></ul></li><li><a href="unsafe.html"><strong>23.</strong> Unsafe Operations</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Rust By Example</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="std_misc/threads/testcase_mapreduce.html#testcase-map-reduce" id="testcase-map-reduce"><h1>Testcase: map-reduce</h1></a>
<p>Rust makes it very easy to parallelise data processing, without many of the headaches traditionally associated with such an attempt.</p>
<p>The standard library provides great threading primitives out of the box.
These, combined with Rust's concept of Ownership and aliasing rules, automatically prevent
data races.</p>
<p>The aliasing rules (one writable reference XOR many readable references) automatically prevent
you from manipulating state that is visible to other threads. (Where synchronisation is needed,
there are synchronisation
primitives like <code>Mutex</code>es or <code>Channel</code>s.)</p>
<p>In this example, we will calculate the sum of all digits in a block of numbers.
We will do this by parcelling out chunks of the block into different threads. Each thread will sum
its tiny block of digits, and subsequently we will sum the intermediate sums produced by each
thread.</p>
<p>Note that, although we're passing references across thread boundaries, Rust understands that we're
only passing read-only references, and that thus no unsafety or data races can occur. Because
we're <code>move</code>-ing the data segments into the thread, Rust will also ensure the data is kept alive
until the threads exit, so no dangling pointers occur.</p>
<pre><pre class="playpen"><code class="language-rust editable">use std::thread;

// This is the `main` thread
fn main() {

    // This is our data to process.
    // We will calculate the sum of all digits via a threaded  map-reduce algorithm.
    // Each whitespace separated chunk will be handled in a different thread.
    //
    // TODO: see what happens to the output if you insert spaces!
    let data = &quot;86967897737416471853297327050364959
11861322575564723963297542624962850
70856234701860851907960690014725639
38397966707106094172783238747669219
52380795257888236525459303330302837
58495327135744041048897885734297812
69920216438980873548808413720956532
16278424637452589860345374828574668&quot;;

    // Make a vector to hold the child-threads which we will spawn.
    let mut children = vec![];

    /*************************************************************************
     * &quot;Map&quot; phase
     *
     * Divide our data into segments, and apply initial processing
     ************************************************************************/

    // split our data into segments for individual calculation
    // each chunk will be a reference (&amp;str) into the actual data
    let chunked_data = data.split_whitespace();

    // Iterate over the data segments.
    // .enumerate() adds the current loop index to whatever is iterated
    // the resulting tuple &quot;(index, element)&quot; is then immediately
    // &quot;destructured&quot; into two variables, &quot;i&quot; and &quot;data_segment&quot; with a
    // &quot;destructuring assignment&quot;
    for (i, data_segment) in chunked_data.enumerate() {
        println!(&quot;data segment {} is \&quot;{}\&quot;&quot;, i, data_segment);

        // Process each data segment in a separate thread
        //
        // spawn() returns a handle to the new thread,
        // which we MUST keep to access the returned value
        //
        // 'move || -&gt; u32' is syntax for a closure that:
        // * takes no arguments ('||')
        // * takes ownership of its captured variables ('move') and
        // * returns an unsigned 32-bit integer ('-&gt; u32')
        //
        // Rust is smart enough to infer the '-&gt; u32' from
        // the closure itself so we could have left that out.
        //
        // TODO: try removing the 'move' and see what happens
        children.push(thread::spawn(move || -&gt; u32 {
            // Calculate the intermediate sum of this segment:
            let result = data_segment
                        // iterate over the characters of our segment..
                        .chars()
                        // .. convert text-characters to their number value..
                        .map(|c| c.to_digit(10).expect(&quot;should be a digit&quot;))
                        // .. and sum the resulting iterator of numbers
                        .sum();

            // println! locks stdout, so no text-interleaving occurs
            println!(&quot;processed segment {}, result={}&quot;, i, result);

            // &quot;return&quot; not needed, because Rust is an &quot;expression language&quot;, the
            // last evaluated expression in each block is automatically its value.
            result

        }));
    }


    /*************************************************************************
     * &quot;Reduce&quot; phase
     *
     * Collect our intermediate results, and combine them into a final result
     ************************************************************************/

    // collect each thread's intermediate results into a new Vec
    let mut intermediate_sums = vec![];
    for child in children {
        // collect each child thread's return-value
        let intermediate_sum = child.join().unwrap();
        intermediate_sums.push(intermediate_sum);
    }

    // combine all intermediate sums into a single final sum.
    //
    // we use the &quot;turbofish&quot; ::&lt;&gt; to provide sum() with a type hint.
    //
    // TODO: try without the turbofish, by instead explicitly
    // specifying the type of intermediate_sums
    let final_result = intermediate_sums.iter().sum::&lt;u32&gt;();

    println!(&quot;Final sum result: {}&quot;, final_result);
}


</code></pre></pre>
<a class="header" href="std_misc/threads/testcase_mapreduce.html#assignments" id="assignments"><h3>Assignments</h3></a>
<p>It is not wise to let our number of threads depend on user inputted data.
What if the user decides to insert a lot of spaces? Do we <em>really</em> want to spawn 2,000 threads?
Modify the program so that the data is always chunked into a limited number of chunks,
defined by a static constant at the beginning of the program.</p>
<a class="header" href="std_misc/threads/testcase_mapreduce.html#see-also" id="see-also"><h3>See also:</h3></a>
<ul>
<li><a href="std_misc/threads.html">Threads</a></li>
<li><a href="std/vec.html">vectors</a> and <a href="trait/iter.html">iterators</a></li>
<li><a href="fn/closures.html">closures</a>, <a href="scope/move.html">move</a> semantics and <a href="https://doc.rust-lang.org/book/second-edition/ch13-01-closures.html#closures-can-capture-their-environment"><code>move</code> closures</a></li>
<li><a href="https://doc.rust-lang.org/book/second-edition/ch18-03-pattern-syntax.html#destructuring-to-break-apart-values">destructuring</a> assignments</li>
<li><a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect">turbofish notation</a> to help type inference</li>
<li><a href="error/option_unwrap.html">unwrap vs. expect</a></li>
<li><a href="https://doc.rust-lang.org/book/loops.html#enumerate">enumerate</a></li>
</ul>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="std_misc/threads.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="std_misc/channels.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="std_misc/threads.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="std_misc/channels.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
